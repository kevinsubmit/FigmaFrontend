# 登录入口分流规则（中文）

## 目标

- H5 前台仅允许普通用户登录。
- 后台管理仅允许超级管理员与店铺管理员登录。
- 防止同一账号跨端误用（例如管理员进入 H5）。

## 当前实现

## 1. 后端强校验

- 登录接口：`POST /api/v1/auth/login`
- 新增请求字段：`login_portal`
  - `frontend`：H5 前台登录
  - `admin`：后台登录
- 角色限制：
  - `login_portal=frontend` 时，`is_admin=True` 或 `store_id!=null` 的账号拒绝登录。
  - `login_portal=admin` 时，普通用户账号拒绝登录。

## 2. 前端参数约束

- H5 登录请求固定携带：`login_portal: "frontend"`
- 后台登录请求固定携带：`login_portal: "admin"`

## 3. 前端兜底保护

- H5 在登录后拉取用户信息时，如发现账号属于管理员/店铺管理员，立即清理登录态并返回登录页。
- H5 路由守卫增加本地角色检查，避免旧 token 导致串端访问。

## 4. 会话过期体验（后台）

- 后台登录会话（access token）时长：`24 小时`。
- 后台 API 客户端统一处理 `401 Unauthorized`：
  - 清理 token
  - 弹出“登录已过期，请重新登录”
  - 跳转 `/admin/login`

## 5. H5 登录/注册提示优化

- 登录页与注册页统一接入认证错误文案映射，避免直接暴露后端原始报错。
- 重点提示场景：
  - 手机号或密码错误
  - 验证码无效或过期
  - 手机号已注册
  - 用户名已占用
  - 账号被停用
  - 管理员/店铺管理员误登录 H5（明确提示去后台登录）
- 目标：让用户在登录失败时能立即理解原因与下一步动作。

## 影响说明

- 超管、店铺管理员将无法登录 H5 前台（符合权限边界）。
- 普通用户将无法登录后台管理（符合安全策略）。
