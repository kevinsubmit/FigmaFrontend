# 2026-02-12 预约拆分规则与颜色图例更新

## 本次更新范围
- 后台 `appointments` 页面拆分逻辑与交互优化。
- 后台 `reviews`、`staff` 页面接口错误修复（含 CORS 侧修复）。
- 店铺详情服务金额输入步进优化。

## 1) 拆分规则更新

### 1.1 允许拆分的订单状态
从仅 `completed` 调整为可在以下状态拆分：
- `pending`
- `confirmed`
- `completed`

`cancelled` 仍不可拆分。

### 1.2 支持清空拆分（非拆分单）
- 允许删除到 0 条拆分行并保存。
- 空拆分表示该订单不是拆分单。

### 1.3 Bind Staff 与拆分关系
- 当存在拆分行时，`Bind Staff` 显示“拆分绑定技师（多人）”。
- 当无拆分行时，保留单人绑定下拉。
- 后端保存拆分后自动处理 `appointment.technician_id`：
  - 拆分仅 1 人：自动绑定该技师
  - 拆分 0 人或多人：清空单人绑定

### 1.4 拆分金额步进
- 拆分金额输入最小值改为 `1`，步进 `1`。
- 前端保存按整数校验（不再允许 `0.01`）。

## 2) appointments 页面颜色说明
- 在列表上方新增“订单颜色说明 / Color Legend”：
  - 待处理 Pending
  - 已确认 Confirmed
  - 已完成 Completed
  - 已取消 Cancelled
  - 冲突 Conflict

## 3) reviews / staff 报错修复

### 3.1 Reviews
- 修复 `reviews/admin` 查询中 `full_name` 字段遗漏导致的 500。

### 3.2 Staff
- 修复 `technicians/performance/summary` 中 schema/model 名称冲突导致的 500。

### 3.3 CORS
- 增加并放宽本地开发跨域：
  - 明确加入 `http://127.0.0.1:3100` 等地址
  - 增加 localhost/127.0.0.1 端口正则匹配

## 4) 店铺服务金额输入
- `StoreDetail` 中服务价格/提成输入改为整数步进 `1`，不允许 `0.01` 微调。
