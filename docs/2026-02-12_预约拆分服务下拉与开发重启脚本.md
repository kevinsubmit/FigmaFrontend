# 2026-02-12 预约拆分服务下拉与开发重启脚本

## 本次目标
- 将后台预约拆分中的 `Work(hand/foot)` 改为店铺服务下拉选择。
- 保证拆分数据按服务维度保存，便于后续提成与统计。
- 提供一键重启开发环境脚本，避免端口漂移和旧进程导致的 404/连接失败。

## 后端改动
- `appointment_staff_splits` 新增 `service_id` 字段。
- 新增迁移：
  - `backend/alembic/versions/20260211_004000_add_service_id_to_appointment_staff_splits.py`
- 拆分接口更新：
  - `GET /api/v1/appointments/{appointment_id}/splits` 返回 `service_id`、`service_name`
  - `PUT /api/v1/appointments/{appointment_id}/splits` 改为接收 `service_id`，并校验服务归属店铺

## 前端改动（Admin）
- 预约详情「技师金额拆分」中间列由文本框改为服务下拉。
- 下拉数据来源改为当前预约所属店铺服务列表。
- 保存校验改为每行必须包含：技师、服务、金额。
- 文案统一为中英双语（便于运营与英文环境共存）。

## 运维脚本
- 新增脚本：`scripts/restart_dev.sh`
- 功能：
  - 停止旧的 backend/admin/h5 进程
  - 执行 `alembic upgrade head`
  - 启动 backend(:8000)、admin(:3100)、h5(:5173)
  - 输出 pid 与日志到 `.run/`
- 已启用 `--strictPort`，避免 Vite 自动跳到 3101 等端口。

## 验证结果
- 后端编译通过。
- Admin 构建通过。
- `GET /api/v1/appointments/{id}/splits` 已不再 404（未登录时返回 403）。

## 使用说明
```bash
cd /Users/fengliangli/code/FigmaFrontend
./scripts/restart_dev.sh
```

仅重启后端：
```bash
./scripts/restart_dev.sh --only-backend
```
