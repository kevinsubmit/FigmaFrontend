# Example Nginx hardening for uploaded files.
# Put this inside your server {} block and adjust root/proxy settings to your deployment.

location /uploads/ {
    # Forward to backend static files or serve from disk.
    proxy_pass http://127.0.0.1:8000/uploads/;

    # Security headers
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-Frame-Options "DENY" always;
    add_header Referrer-Policy "no-referrer" always;
    add_header Content-Security-Policy "default-src 'none'; img-src 'self' data: blob:; style-src 'none'; script-src 'none'" always;

    # Only allow image methods for browsing assets
    limit_except GET HEAD { deny all; }
}

# If any non-image extension is accidentally present under uploads, force download.
location ~* ^/uploads/.*\.(html?|js|mjs|css|svg|xml|json|php|pl|py|sh|exe|dll|bat)$ {
    add_header Content-Disposition "attachment" always;
    add_header X-Content-Type-Options "nosniff" always;
    return 403;
}
